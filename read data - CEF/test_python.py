import numpy as np
import matplotlib.pyplot as plt

ratio_list = np.linspace(1, 1.5, 6)
B66_list = np.linspace(0, 30e-6, 31)
II = [[14.053468818363923, 13.683890400827421, 12.916977296292126, 12.228928259136639, 13.831922391187796,
       15.337471689120582, 16.39656927700546, 17.44034652374673, 18.660404598589558, 20.27807983257822,
       14.166312974012776, 14.49971696510441, 14.957388439087458, 15.57792905071884, 16.280459005798058,
       16.99853321207237, 17.630976152669344, 18.134313536632366, 18.28921866702596, 18.326128014049324,
       18.384952330993578, 18.597582842393503, 19.01819549210261, 19.469695221642176, 20.03824468332747,
       20.665974231241897, 21.722057223230173, 26.526757925475962, 24.875615985341184, 25.277068795295836,
       27.092620858344162],
      [9.840796490530527, 9.801693569383803, 9.813345787432292, 10.630471450623233, 9.899171858022042,
       15.082042724897935, 10.524484424426351, 10.94496999163691, 11.431355146327657, 11.882173257201577,
       25.51216734017018, 29.092037732530482, 33.74421205944976, 43.45359086114588, 13.921254967204792,
       14.53367189940668, 15.33923590364762, 15.340566597221288, 15.379510686314761, 15.300429027021616,
       15.21831179516949, 15.23760959947831, 15.416144990753084, 15.707997847647857, 16.08485909093849,
       16.592609330787102, 18.95141216562577, 19.099486038255485, 20.128012404256058, 20.89363560236143,
       22.968646214219476],
      [9.556085557300811, 9.487303085554045, 9.304810849726863, 9.87958420779024, 9.516934668527421, 9.723498260328075,
       10.002838051579834, 21.055130871402362, 10.766863823329066, 11.103984036371664, 30.45000659568896,
       34.570702631636195, 43.04694802612377, 48.65331636548234, 12.712604752590593, 13.201684265243948,
       13.542252484892531, 13.664487328632157, 13.596110683355095, 13.400017848616802, 13.264625502128034,
       13.158239989406276, 13.179658504935775, 13.378761806752756, 13.60728405385137, 14.195230633551398,
       14.998876574716114, 16.141295305020716, 17.014808854912847, 18.511953713236878, 37.079462048971706],
      [10.329235289027466, 10.229139142996647, 9.892163390740361, 9.627264586066522, 10.15983646373583,
       10.25937183433413, 10.459677303969462, 10.739463844142438, 11.07241194694805, 11.300512829542743,
       11.368634138028645, 11.472896911976179, 49.25036786174362, 12.113893133629182, 12.521483237194735,
       12.865875831955474, 12.965219146525639, 12.964405506644173, 12.815006135219202, 12.58737171420592,
       12.34878492030473, 12.156207843028975, 12.063469149624332, 12.203430197364531, 12.301464826500146,
       12.663622247696335, 13.393047785649141, 14.286958382113996, 15.136752164080194, 36.46585671721123,
       18.725700871248364],
      [12.106191127099418, 11.950409642312769, 11.624636410696016, 13.504837216429298, 11.752614263829607,
       11.740994767776305, 11.829649726248181, 12.035406648181493, 12.285993359219296, 12.423724158398366,
       12.423646149448842, 12.489487754114144, 12.695807793967944, 12.966544490400421, 13.251212689734794,
       13.43754394888997, 13.279574311134931, 13.158031338956064, 12.932438871339986, 12.654995618909759,
       12.368663254590714, 12.113351752228672, 11.927159335042651, 12.026293122527237, 11.855327123103397,
       12.151017546230666, 12.795594749905923, 13.420617480814865, 14.289121085019326, 35.769403603806836,
       18.219660636313726],
      [14.871446549119868, 14.703045189392524, 14.301860928922984, 13.771427375022386, 14.264310430504718,
       14.114570809407153, 14.094955814556632, 14.215695973234144, 14.388774696721681, 14.441932854911338,
       14.392673275811449, 14.425491112845204, 14.557545327207107, 14.726889486352887, 14.862996309129823,
       14.855924719416043, 14.419939267974879, 14.190620667230325, 13.896056352457764, 13.582825563405498,
       13.258658426871795, 12.950684327765968, 12.684019161854339, 12.754171013372341, 12.339411817228289,
       12.570047340659404, 40.30820995825501, 13.504204031091204, 38.82849061712389, 16.34576464548794,
       18.660149449886042]]

### finer step near global minimum

ratio_list = np.linspace(1., 1.5, 11)
B66_list = np.linspace(0e-6, 30e-6, 31)
II = [[11.271870737108998, 11.257722067503513, 11.270422992849651, 10.827317200069023, 11.39031586819388,
       11.735647594722467, 12.157420991012541, 12.596407065849347, 13.152458575469595, 13.730859773620528,
       14.165913710260897, 14.500285211745876, 14.957264035777149, 15.582032619615303, 16.27987384621415,
       16.99821284078449, 17.636357827226586, 18.135131786321537, 18.346167234201484, 18.324214367062055,
       18.389263085737763, 18.598680598463577, 19.015883124476904, 19.466887570058287, 20.034344139119366,
       20.66563737678805, 21.79018697028502, 27.22653060360654, 39.82710336538485, 29.31907106861796,
       32.61643790892921],
      [10.410347525032702, 10.3842477840009, 10.350223564369673, 9.9512049891834, 10.496092440143943,
       10.809294829469234, 11.167461750853123, 11.633675123491672, 12.15307586968344, 12.614865265988016,
       13.018836766143595, 13.294718281801215, 13.712693043395724, 14.28935454892213, 14.945758414348463,
       15.612032624551581, 16.20687587670724, 16.58613980251504, 16.677986608587453, 16.655530872157808,
       16.630876117187398, 16.736550694284116, 17.024400436337615, 17.383081254365738, 17.84754043340577,
       18.414990156249775, 20.087308164165268, 21.06823913204071, 22.239154528569255, 27.756087298596103,
       24.83220176193381],
      [9.846683823528362, 9.806875656680893, 9.72823631040301, 9.63986865461071, 9.898113553414186, 10.16299295254427,
       10.525954485087057, 10.950945117746206, 11.4321293149294, 11.882466610173838, 12.163846537834036,
       12.392016265447017, 12.775872933154238, 13.311545791157739, 13.921372259231871, 14.532690943789493,
       15.098716889028701, 15.340508552523323, 15.377184375458567, 15.30048564913494, 15.214617395667663,
       15.233836232637325, 15.41619941274173, 15.70731820313426, 16.08449885827305, 16.592356327118797,
       18.242006286844717, 19.085280337194277, 20.114584954428302, 26.022774544976272, 22.969019363828465],
      [9.565608039190565, 9.511891624425088, 9.27231730849747, 9.02320931724381, 9.584673617167338, 9.821313914490663,
       10.139225804667205, 10.53074411606065, 10.97400119556083, 11.366519908889295, 11.583586901184649,
       11.772566371248178, 12.125712528628334, 12.621541393555212, 13.182165952869143, 13.736039646759375,
       14.189123219886278, 14.37494902010803, 14.357144190357186, 14.228320721183357, 14.098319329036856,
       14.051591249662046, 14.14605150982093, 14.385468890463804, 14.685237614421359, 15.136590081231779,
       16.230170521493957, 17.451699844013476, 18.391062540186834, 19.923360676211665, 21.458448807226436],
      [9.558551306238071, 9.489185295815215, 9.135675631315266, 8.984356046356664, 9.517233607020458, 9.724503576495263,
       10.005100290287029, 10.360956898138882, 10.76663147661762, 11.033191151769772, 11.264304220493981,
       11.419944031120876, 11.744503403751143, 12.200049801264162, 12.712569212244757, 13.201975519443158,
       13.542438889573328, 13.66449882736242, 13.599375119627187, 13.43295132018422, 13.26170298340186,
       13.153846875826828, 13.179686735806856, 13.378825498560689, 13.60722550588544, 14.120043766609161,
       14.998722864819145, 16.133478858166136, 17.016297717237702, 18.323600747976904, 20.26361409212193],
      [9.814588459739726, 9.730436812534697, 9.38999846143792, 9.183510311595953, 9.71803132406229, 9.87592419192819,
       10.113753994824197, 10.432879841915868, 10.800916672675163, 11.031973269962611, 11.195515450436664,
       11.323447762793156, 11.620141259985516, 12.033957655434277, 12.494253900413026, 12.915697334583903,
       13.138278524301674, 13.202358586944547, 13.088696081097854, 12.892308974145822, 12.681139085309868,
       12.529045333016015, 12.491965302745617, 12.658607819761235, 12.820206774269009, 13.298773541881275,
       14.060890598618354, 15.084326782737714, 15.938280601681242, 23.69732955211817, 19.36003379700134],
      [10.329390902007635, 10.229113491704382, 9.892118674420042, 9.62414348987632, 10.15999419645578,
       10.266474145141743, 10.45755078135455, 10.739131117927435, 11.069457348306306, 11.268567592604828,
       11.369388571390278, 11.472841059527186, 11.741749512058687, 12.113220064593548, 12.517457591019738,
       12.864417249097828, 12.964894743999603, 13.059364596103451, 12.812977539913081, 12.588150991995782,
       12.34810016563809, 12.156430050162705, 12.063491324554379, 12.203433786404755, 12.301365409562157,
       12.663585162222759, 13.393414875122083, 14.286799695663749, 15.138356589200747, 22.560691609833686,
       18.729005339555485],
      [11.09670155698917, 11.00622636903627, 10.556016415935794, 10.622425727725664, 10.840225164633404,
       10.889939572548144, 11.031081664635394, 11.274513757304273, 11.566437350802575, 11.747785409104827,
       11.781077698895194, 11.86346604826541, 12.10168425231391, 12.429297108494522, 12.772877784860663,
       13.040422493820573, 13.01328206364176, 12.903971664962677, 12.763150563314003, 12.510330747418953,
       12.245675512789061, 12.020294864671907, 11.87919889049501, 11.996840319132433, 11.965331468844523,
       12.286163034368307, 12.97735358126084, 13.732684518676313, 14.593148202197282, 21.718095605857062,
       18.35509566123127],
      [12.11173386134488, 11.954908960266716, 11.604369219872027, 11.637297217228408, 11.75375276856669,
       11.741334165007089, 11.830377453918151, 12.034525819948033, 12.28739290288671, 12.422163806208504,
       12.423230211728487, 12.489882656950387, 12.693759886800317, 12.974753531742197, 13.252859008671,
       13.435098926328438, 13.27554775100591, 13.157013104634316, 12.931498200712317, 12.654745925765997,
       12.36856483364271, 12.112830331927057, 11.926565194520169, 12.026053155796687, 11.855340807557424,
       12.15223183978812, 12.79544278404537, 13.4200353685105, 22.87990071573968, 15.998017243835427,
       18.224891670395014],
      [13.370947676157671, 13.220549789389336, 12.824741089269628, 12.905142331711707, 12.895994843734929,
       12.816895132440857, 12.851862707783525, 13.015484887284378, 13.22881320298727, 13.320105576643176,
       13.294919362746631, 13.342449610313926, 13.514163950973852, 13.745018358925837, 13.95104682564312,
       14.041996502675932, 13.76557036237937, 13.572360069113135, 13.312447267538131, 13.014150398315511,
       12.708672884000109, 12.425152679950576, 12.19804533540767, 12.280858063448195, 11.984884961284745,
       12.24956670208229, 12.837237988317263, 13.348345451318721, 22.487133113318244, 16.05899361821283,
       18.32461038378475],
      [14.871371514718525, 14.71499263473833, 14.282029490545385, 15.199199673432261, 14.264930184604236,
       14.113950282998843, 14.092667892242018, 14.217437076115003, 14.514450112802104, 14.439731337277365,
       14.392488751735064, 14.419734060857166, 14.556839636047302, 14.734356269070313, 14.860500148634419,
       14.855795344496084, 14.444656327376476, 14.192470766357356, 13.900729269486815, 13.582147051550939,
       13.260038858256536, 12.949205292176755, 12.682709360162583, 12.440073109251143, 12.33966580918228,
       12.570939906564094, 13.089815960349885, 24.206024241371072, 14.377223317370847, 16.349604653570495,
       18.660043661113992]]

# ratio_list = np.linspace(1., 1.35, 8)
# B66_list = np.linspace(10e-6, 30e-6, 21)
# II_2 = [[14.165913710712779, 14.500285211755935, 14.957264035777149, 15.582032619612104, 16.279873846211427,
#          16.99821284081274, 17.622398620246347, 18.135131786321537, 18.346167234201484, 18.32421436702178,
#          18.389263085737763, 18.598680598510583, 19.015883124476904, 19.466887570058287, 20.034344139119366,
#          20.66563737678805, 21.785353034557946, 27.22653060360654, 39.8271033654415, 29.31907106861796,
#          32.61643790892921],
#         [13.01883676613789, 13.294718281793424, 13.712693043395724, 14.289354548922853, 14.945758414353712,
#          15.612032624527908, 16.20687608320343, 16.58613980251504, 16.677986608587453, 16.655530873735618,
#          16.630876117187398, 16.736550694281636, 17.024400436337615, 17.383081254365738, 17.84754043340577,
#          18.414990156249775, 20.087308162650984, 21.06823913204071, 22.23915452859162, 27.756087298596103,
#          24.83220176193381],
#         [12.163846537854965, 12.392016265431312, 12.775872933154238, 13.311545791113772, 13.921372259568406,
#          14.53269094380335, 15.098716782403141, 15.340508552523323, 15.377184375458567, 15.300485262215185,
#          15.214617395667663, 15.23383623262876, 15.41619941274173, 15.70731820313426, 16.08449885827305,
#          16.592356327118797, 18.242006239670065, 19.085280337194277, 20.11447902464852, 26.022774544976272,
#          22.969019363828465],
#         [11.583586901202406, 11.772566371238126, 12.125712528628334, 12.62158487249618, 13.182165952820505,
#          13.736039646658572, 14.189123219382102, 14.37494902010803, 14.357144190357186, 14.228320721432992,
#          14.098319329036856, 14.051591249668569, 14.14605150982093, 14.385468890463804, 14.685237614421359,
#          15.136590081231779, 16.230170521462536, 17.451699844013476, 18.391062540205535, 19.923360676211665,
#          21.458448807226436],
#         [11.264304220827832, 11.419944031108034, 11.744503403751143, 12.200049801226898, 12.71256898203336,
#          13.201975519274344, 13.542438889583709, 13.66449882736242, 13.599375119627187, 13.432951320161456,
#          13.26170298340186, 13.153846875830036, 13.179686735806856, 13.378825498560689, 13.60722550588544,
#          14.120043766609161, 14.99872286484905, 16.133478858166136, 17.0162977172101, 18.323600747976904,
#          20.26361409212193],
#         [11.19551545042635, 11.323447762765886, 11.620141259985516, 12.033957655397163, 12.49413114972639,
#          12.915697334551536, 13.138278902264451, 13.202358586944547, 13.088696081097854, 12.892308973874863,
#          12.681139085309868, 12.52904533301575, 12.491965302745617, 12.658607819761235, 12.820206774269009,
#          13.298773541881275, 14.0608905986233, 15.084326782737714, 15.938280601276078, 23.69732955211817,
#          19.36003379700134],
#         [11.369376475265513, 11.472841059550621, 11.741749512058687, 12.113220064599515, 12.517457591010604,
#          12.86441724908209, 12.964894744182908, 13.059364596103451, 12.812977539913081, 12.588150992009158,
#          12.34810016563809, 12.156430050174995, 12.063491324554379, 12.203433786404755, 12.301365409562157,
#          12.663585162222759, 13.393414875099133, 14.286799695663749, 15.138356589148762, 22.560691609833686,
#          18.729005339555485],
#         [11.78107769903359, 11.863466080586962, 12.10168425231391, 12.429297108497588, 12.77287778486655,
#          13.040422493967762, 13.013282108248754, 12.903971664962677, 12.763150563314003, 12.510330747335942,
#          12.245675512789061, 12.020294864645187, 11.87919889049501, 11.996840319132433, 11.965331468844523,
#          12.286163034368307, 12.9773535812355, 13.732684518676313, 14.593148202026946, 21.718095605857062,
#          18.35509566123127]]

II = np.array(II)

fig, ax = plt.subplots()
cp = ax.pcolormesh(B66_list, ratio_list, II, cmap='jet',vmax=20)
colorbar = fig.colorbar(cp, ax=ax)
colorbar.set_label(r'$\chi_\nu^2$', fontsize=20)
colorbar.ax.tick_params(labelsize=20, size=8)
# cp = ax.pcolormesh(B40_list, field_list, II, cmap='jet')
ax.set_xlabel(r'$B^6_6$', fontsize=20)
ax.set_ylabel('ratio', fontsize=20)
ax.tick_params(axis='both', which='major', labelsize=20)
ax.ticklabel_format(style='sci', axis='x', scilimits=(0, 0))
ax.xaxis.get_offset_text().set_fontsize(14)
ax.set_xlim(left=0, right=3.05e-5)
ax.set_ylim(bottom=1, top=1.52)
plt.tight_layout()
# fig.colorbar(mappable=cp)

plt.savefig("../plots/chi_sq.png",dpi=300)
plt.show()

# Find the flat index of the minimum value
flat_min_index = np.argmin(II)
min_index = np.unravel_index(flat_min_index, II.shape)
print(min_index)
print(II[min_index])

# B40_list = np.linspace(-0.0005, -6e-4, 11)
# print(B40_list[9])
# field_list = np.linspace(0, 1.5, 16)
# print(field_list[9])
